<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Cute 核心概念 - CUTLASS Notes</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Cute \u6838\u5fc3\u6982\u5ff5";
        var mkdocs_page_input_path = "cute_core.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CUTLASS Notes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">CuTe</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Cute 核心概念</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_1">核心组件</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_2">基本数据类型</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_3">数值类型</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_4">示例</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_5">坐标系统</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_6">坐标类型</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_7">坐标操作示例</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_8">编译时计算</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_9">编译时操作</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_10">示例</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cute_1">CuTe 的设计哲学</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1">1. 编译时优化</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2">2. 抽象与性能的平衡</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3">3. 模块化设计</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cute_2">CuTe 与其他库的关系</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-cutlass">1. 与 CUTLASS 的关系</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-cuda">2. 与 CUDA 的关系</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3_1">3. 与标准库的关系</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cute_3">使用 CuTe 的优势</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_11">基本使用模式</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1_1">1. 定义数据结构</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2_1">2. 执行操作</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3_2">3. 线程协作</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cute_layout/">Layout 布局系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cute_tensor/">Tensor 张量操作</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Copy 操作</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../cute_copy/">Copy 操作详解</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cute_tma_copy/">TMA Copy 操作</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >MMA 操作</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../cute_mma/">MMA 操作详解</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cute_wgmma_sm90/">GMMA(SM90)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cute_examples/">实际应用示例</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CUTLASS Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">CuTe</li>
      <li class="breadcrumb-item active">Cute 核心概念</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cute">CuTe 核心概念</h1>
<p>CuTe (CUDA Template Engine) 是 NVIDIA 开发的一个 C++ 模板库，用于在编译时操作和优化张量计算。它提供了强大的抽象能力，使得开发者能够编写高性能、可维护的 CUDA 代码。</p>
<h2 id="_1">核心组件</h2>
<p>CuTe 的核心组件包括：</p>
<ul>
<li><strong>Layout</strong>：描述逻辑坐标到线性内存位置的映射关系</li>
<li><strong>Tensor</strong>：结合数据指针和 Layout 的多维数据结构</li>
<li><strong>Engine</strong>：管理 Tensor 的数据访问和存储</li>
<li><strong>Copy</strong>：实现高效的数据复制操作</li>
<li><strong>MMA</strong>：实现矩阵乘加操作</li>
</ul>
<h2 id="_2">基本数据类型</h2>
<p>CuTe 使用一系列基本数据类型来表示编译时的数值和形状信息。</p>
<h3 id="_3">数值类型</h3>
<ul>
<li><strong>Int<N></strong>：编译时常量整数类型</li>
<li><strong>Shape</strong>：描述张量形状的类型</li>
<li><strong>Stride</strong>：描述张量步幅的类型</li>
<li><strong>Layout</strong>：描述坐标到线性位置映射的类型</li>
</ul>
<h3 id="_4">示例</h3>
<pre><code class="language-cpp">// 定义编译时常量
using size_m = Int&lt;128&gt;;
using size_n = Int&lt;64&gt;;

// 定义形状
using tile_shape = Shape&lt;size_m, size_n&gt;;

// 定义步幅
using tile_stride = Stride&lt;Int&lt;1&gt;, size_m&gt;;
</code></pre>
<h2 id="_5">坐标系统</h2>
<p>CuTe 使用坐标系统来访问多维数据结构。</p>
<h3 id="_6">坐标类型</h3>
<ul>
<li><strong>Coord</strong>：基本坐标类型</li>
<li><strong>make_coord</strong>：创建坐标对象的函数</li>
</ul>
<h3 id="_7">坐标操作示例</h3>
<pre><code class="language-cpp">// 创建二维坐标
auto coord_2d = make_coord(10, 20);

// 访问坐标分量
auto x = get&lt;0&gt;(coord_2d);  // 获取第一个分量
auto y = get&lt;1&gt;(coord_2d);  // 获取第二个分量

// 创建多维坐标
auto coord_4d = make_coord(1, 2, 3, 4);
</code></pre>
<h2 id="_8">编译时计算</h2>
<p>CuTe 大量使用编译时计算来优化性能。</p>
<h3 id="_9">编译时操作</h3>
<ul>
<li><strong>静态断言</strong>：在编译时验证条件</li>
<li><strong>模板特化</strong>：根据不同类型提供不同实现</li>
<li><strong>constexpr 函数</strong>：编译时执行的函数</li>
</ul>
<h3 id="_10">示例</h3>
<pre><code class="language-cpp">// 使用静态断言验证条件
static_assert(is_static&lt;Shape&lt;_128,_64&gt;&gt;::value, &quot;Shape must be static&quot;);

// constexpr 函数示例
template &lt;class Shape&gt;
CUTE_HOST_DEVICE constexpr auto
get_total_size(Shape const&amp; shape) {
  return size(shape);
}
</code></pre>
<h2 id="cute_1">CuTe 的设计哲学</h2>
<p>CuTe 的设计遵循以下哲学：</p>
<h3 id="1">1. 编译时优化</h3>
<p>CuTe 将尽可能多的计算移到编译时，以减少运行时开销。</p>
<pre><code class="language-cpp">// 编译时确定的形状和步幅
using ThreadLayout = Layout&lt;Shape&lt;_4,_8&gt;, Stride&lt;_8,_1&gt;&gt;;

// 编译时计算内存访问模式
auto thread_layout = ThreadLayout{};
</code></pre>
<h3 id="2">2. 抽象与性能的平衡</h3>
<p>CuTe 提供高层次的抽象，同时保证不牺牲性能。</p>
<pre><code class="language-cpp">// 高层次抽象，但生成高效的代码
auto tensor = make_tensor(ptr, make_layout(make_shape(M, N), GenRowMajor{}));
</code></pre>
<h3 id="3">3. 模块化设计</h3>
<p>CuTe 的组件设计为可组合的模块，可以灵活组合使用。</p>
<pre><code class="language-cpp">// 组合不同的组件
auto tiled_copy = make_tiled_copy(Copy_Atom{}, 
                                 make_shape(BLK_M, BLK_N),
                                 make_shape(THR_M, THR_N));
</code></pre>
<h2 id="cute_2">CuTe 与其他库的关系</h2>
<p>CuTe 与其他 CUDA 相关库有以下关系：</p>
<h3 id="1-cutlass">1. 与 CUTLASS 的关系</h3>
<p>CuTe 是 CUTLASS 3.0 的核心组件，提供了底层的张量操作抽象。</p>
<h3 id="2-cuda">2. 与 CUDA 的关系</h3>
<p>CuTe 生成的代码直接编译为 CUDA 代码，可以与原生 CUDA 代码无缝集成。</p>
<h3 id="3_1">3. 与标准库的关系</h3>
<p>CuTe 借鉴了标准库的一些设计思想，但针对 GPU 计算进行了优化。</p>
<h2 id="cute_3">使用 CuTe 的优势</h2>
<p>使用 CuTe 具有以下优势：</p>
<ul>
<li><strong>性能</strong>：通过编译时优化生成高效的代码</li>
<li><strong>灵活性</strong>：支持各种数据布局和内存访问模式</li>
<li><strong>可维护性</strong>：提供高层次抽象，使代码更易理解和维护</li>
<li><strong>可扩展性</strong>：模块化设计支持灵活组合和扩展</li>
</ul>
<h2 id="_11">基本使用模式</h2>
<p>使用 CuTe 的基本模式包括：</p>
<h3 id="1_1">1. 定义数据结构</h3>
<pre><code class="language-cpp">// 定义张量形状
auto shape = make_shape(Int&lt;128&gt;{}, Int&lt;64&gt;{});

// 定义内存布局
auto layout = make_layout(shape, GenRowMajor{});

// 创建张量
auto tensor = make_tensor(ptr, layout);
</code></pre>
<h3 id="2_1">2. 执行操作</h3>
<pre><code class="language-cpp">// 执行复制操作
copy(src_tensor, dst_tensor);

// 执行矩阵乘法
gemm(A, B, C);
</code></pre>
<h3 id="3_2">3. 线程协作</h3>
<pre><code class="language-cpp">// 获取线程切片
auto tile = tiled_copy.get_slice(thread_idx);

// 分区张量
auto src_frag = tile.partition_S(src_tensor);
auto dst_frag = tile.partition_D(dst_tensor);
</code></pre>
<p>这些核心概念构成了 CuTe 的基础，理解它们对于有效使用 CuTe 至关重要。</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cute_layout/" class="btn btn-neutral float-right" title="Layout 布局系统">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cute_layout/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
